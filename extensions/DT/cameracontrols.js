// Name: Camera Controls (Very Buggy)
// ID: DTcameracontrols
// Description: Move the visible part of the stage.
// By: DT
// License: MIT

/* generated l10n code */Scratch.translate.setup({"fi":{"_Camera (Very Buggy)":"Kamera (todella buginen)","_background color":"taustaväri","_camera direction":"kameran suunta","_camera x":"kameran x-sijainti","_camera y":"kameran y-sijainti","_camera zoom":"kameran lähennys","_change camera x by [val]":"lisää kameran x:n arvoon [val]","_change camera y by [val]":"lisää kameran y:n arvoon [val]","_change camera zoom by [val]":"lähennä kameraa arvolla [val]","_move camera [val] steps":"liikuta kameraa [val] askelta ","_move camera to [sprite]":"siirrä kamera hahmon [sprite] kohdalle","_no sprites exist":"ei hahmoja","_point camera towards [sprite]":"kohdista kamera hahmon [sprite] suuntaan","_set background color to [val]":"aseta taustaväriksi [val]","_set camera direction to [val]":"kohdista kamera suuntaan [val]","_set camera to x: [x] y: [y]":"siirrä kamera sijaintiin x: [x] y: [y]","_set camera x to [val]":"aseta kameran x:n arvoksi [val]","_set camera y to [val]":"aseta kameran y:n arvoksi [val]","_set camera zoom to [val] %":"aseta kameran lähennykseksi [val] %","_turn camera [image] [val] degrees":"käännä kameraa [image] [val] astetta"},"it":{"_Camera (Very Buggy)":"Camera (Presenti Diversi Bug)","_background color":"colore di sfondo","_camera direction":"direzione camera","_camera x":"x camera","_camera y":"y camera","_camera zoom":"zoom camera","_change camera x by [val]":"cambia camera x di [val]","_change camera y by [val]":"cambia camera y di [val]","_change camera zoom by [val]":"cambia zoom camera di [val]","_move camera [val] steps":"sposta camera di [val]passi","_move camera to [sprite]":"sposta la camera dove si trova [sprite]","_no sprites exist":"non ci sono sprite","_point camera towards [sprite]":"punta camera verso [sprite]","_set background color to [val]":"usa colore di sfondo [val]","_set camera direction to [val]":"porta direzione camera a [val]","_set camera to x: [x] y: [y]":"sposta la camera a x: [x] y: [y]","_set camera x to [val]":"porta camera x a [val]","_set camera y to [val]":"porta camera y a [val]","_set camera zoom to [val] %":"porta zoom camera a [val] %","_turn camera [image] [val] degrees":"gira camera [image] di [val] gradi"},"ja":{"_Camera (Very Buggy)":"カメラ操作 (非常に動作が不安定)","_background color":"背景色","_camera direction":"カメラの向き","_camera x":"カメラのx座標","_camera y":"カメラのy座標","_camera zoom":"カメラズーム","_change camera x by [val]":"カメラのx座標を[val]ずつ変える","_change camera y by [val]":"カメラのy座標を[val]ずつ変える","_change camera zoom by [val]":"カメラのズームを[val]で変更する","_move camera [val] steps":"カメラを[val]歩動かす","_move camera to [sprite]":"カメラを[sprite]に移動する","_no sprites exist":"スプライトは存在しない","_point camera towards [sprite]":"カメラを[sprite]へ向ける","_set background color to [val]":"背景色を[val]に設定する","_set camera direction to [val]":"カメラを[val]度に向ける","_set camera to x: [x] y: [y]":"カメラのx座標を[x]、y座標を[y]にする","_set camera x to [val]":"カメラのx座標を[val]にする","_set camera y to [val]":"カメラのy座標を[val]にする","_set camera zoom to [val] %":"カメラのズームを[val]%に設定する","_turn camera [image] [val] degrees":"カメラを[image][val]度回す"},"ko":{"_Camera (Very Buggy)":"카메라 (오류 많음)","_background color":"배경색","_camera direction":"카메라 방향","_camera x":"카메라 x","_camera y":"카메라 y","_camera zoom":"카메라 줌","_change camera x by [val]":"카메라의 x좌표를 [val]만큼 바꾸기","_change camera y by [val]":"카메라의 y좌표를 [val]만큼 바꾸기","_change camera zoom by [val]":"카메라의 줌을 [val]만큼 바꾸기","_move camera [val] steps":"카메라를 [val] 만큼 움직이기","_move camera to [sprite]":"카메라를 [sprite](으)로 이동하기","_no sprites exist":"(스프라이트 없음)","_point camera towards [sprite]":"카메라를 [sprite]쪽으로 바라보기","_set background color to [val]":"배경색을 [val](으)로 정하기","_set camera direction to [val]":"카메라의 방향을 [val](으)로 정하기","_set camera to x: [x] y: [y]":"카메라를 x:[x] y:[y] (으)로 이동하기","_set camera x to [val]":"카메라의 x좌표를 [val](으)로 정하기","_set camera y to [val]":"카메라의 y좌표를 [val](으)로 정하기","_set camera zoom to [val] %":"카메라의 줌을 [val]%로 정하기","_turn camera [image] [val] degrees":"카메라를 [image] [val]도 돌기"},"nb":{"_Camera (Very Buggy)":"Kamera (Veldig Ustabil)","_background color":"Bakgrunnsfarge","_camera direction":"kamera retning","_camera x":"kamera x","_camera y":"kamera y","_camera zoom":"kamera zoom","_change camera x by [val]":"endre kamera x med [val]","_change camera y by [val]":"endre kamera y med [val]","_change camera zoom by [val]":"endre kamera zoom med [val]","_move camera [val] steps":"flytt kamera [val] trinn","_move camera to [sprite]":"flytt kamera til [sprite]","_no sprites exist":"ingen sprites eksisterer","_point camera towards [sprite]":"peker kameraet mot [sprite]","_set background color to [val]":"sett bakgrunnsfarge til [val]","_set camera direction to [val]":"sett kamera retning til [val]","_set camera to x: [x] y: [y]":"sett kamera til x: [x] y: [y]","_set camera x to [val]":"sett kamera x til [val]","_set camera y to [val]":"sett kamera y til [val]","_set camera zoom to [val] %":"sett kamera zoom til [val] %","_turn camera [image] [val] degrees":"snu kamera [image] [val] grader"},"nl":{"_Camera (Very Buggy)":"Camera (veel bugs)","_background color":"achtergrondkleur","_camera direction":"camera-richting","_camera x":"camera-x","_camera y":"camera-y","_camera zoom":"camera-zoom","_change camera x by [val]":"verander camera-x met [val]","_change camera y by [val]":"verander camera-y [val]","_change camera zoom by [val]":"verander camera-zoom met [val]","_move camera [val] steps":"verplaats camera [val] stappen","_move camera to [sprite]":"verplaats camera naar [sprite]","_no sprites exist":"...","_point camera towards [sprite]":"richt camera naar [sprite]","_set background color to [val]":"maak achtergrondkleur [val]","_set camera direction to [val]":"richt camera naar [val] graden","_set camera to x: [x] y: [y]":"verplaats camera naar x: [x] y: [y]","_set camera x to [val]":"maak camera-x [val]","_set camera y to [val]":"maak camera-y [val]","_set camera zoom to [val] %":"maak camera-zoom [val] %","_turn camera [image] [val] degrees":"draai camera [image] [val] graden"},"pl":{"_background color":"kolor tła"},"ru":{"_Camera (Very Buggy)":"Камера (Очень Баганное)","_background color":"цвет заднего фона","_camera direction":"направление камеры","_camera x":"x камеры","_camera y":"y камеры","_camera zoom":"приближение камеры","_change camera x by [val]":"изменить x камеры на [val]","_change camera y by [val]":"изменить y камеры на [val]","_change camera zoom by [val]":"изменить приближение камеры на [val]","_move camera [val] steps":"пойти камеру на [val] шагов","_move camera to [sprite]":"двинуть камеру на [sprite]","_no sprites exist":"никаких спрайтов не существует","_point camera towards [sprite]":"навести камеру на [sprite]","_set background color to [val]":"задать цвет заднего фона на [val]","_set camera direction to [val]":"задать направление камеры на [val]","_set camera to x: [x] y: [y]":"задать позиции камеры на x: [x] y: [y]","_set camera x to [val]":"задать x камеры на [val]","_set camera y to [val]":"задать y камеры на [val]","_set camera zoom to [val] %":"задать приближение камены в [val]%","_stage to world x: [x]":"сцену на x мира: [x]","_stage to world y: [y]":"сцену на y мира: [y]","_turn camera [image] [val] degrees":"повернуть камеру [image] на [val] градусов"},"zh-cn":{"_Camera (Very Buggy)":"舞台摄像机(有Bug)","_background color":"背景颜色","_camera direction":"摄像机的方向","_camera x":"摄像机x坐标","_camera y":"摄像机y坐标","_camera zoom":"摄像机视野","_change camera x by [val]":"摄像机的x坐标增加[val]","_change camera y by [val]":"摄像机的y坐标增加[val]","_change camera zoom by [val]":"摄像机拉近[val]","_move camera [val] steps":"摄像机移动[val]步","_move camera to [sprite]":"移动摄像机到角色[sprite]","_no sprites exist":"没有角色","_point camera towards [sprite]":"摄像机面向[sprite]","_set background color to [val]":"设置背景颜色为[val]","_set camera direction to [val]":"设置摄像机的方向为[val]","_set camera to x: [x] y: [y]":"设置摄像机的坐标为x[x] y[y]","_set camera x to [val]":"设置摄像机的x坐标为[val]","_set camera y to [val]":"设置摄像机的y坐标为[val]","_set camera zoom to [val] %":"设置摄像机视野为[val]%","_turn camera [image] [val] degrees":"摄像机[image][val]度"}});/* end generated l10n code */((Scratch) => {
  "use strict";

  if (!Scratch.extensions.unsandboxed) {
    throw new Error("Camera extension must be run unsandboxed");
  }

  const icon =
    "data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHdpZHRoPSIyMjUuMzU0OCIgaGVpZ2h0PSIyMjUuMzU0OCIgdmlld0JveD0iMCwwLDIyNS4zNTQ4LDIyNS4zNTQ4Ij48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTg3LjMyMjkzLC0zNy4zMjI1OSkiPjxnIGRhdGEtcGFwZXItZGF0YT0ieyZxdW90O2lzUGFpbnRpbmdMYXllciZxdW90Ozp0cnVlfSIgZmlsbC1ydWxlPSJub256ZXJvIiBzdHJva2U9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJidXR0IiBzdHJva2UtbGluZWpvaW49Im1pdGVyIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHN0cm9rZS1kYXNoYXJyYXk9IiIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjAiIHN0eWxlPSJtaXgtYmxlbmQtbW9kZTogbm9ybWFsIj48cGF0aCBkPSJNMTg3LjMyMjk0LDE1MGMwLC02Mi4yMzAwMSA1MC40NDczOSwtMTEyLjY3NzQgMTEyLjY3NzQsLTExMi42Nzc0YzYyLjIzMDAxLDAgMTEyLjY3NzQsNTAuNDQ3MzkgMTEyLjY3NzQsMTEyLjY3NzRjMCw2Mi4yMzAwMSAtNTAuNDQ3MzksMTEyLjY3NzQgLTExMi42Nzc0LDExMi42Nzc0Yy02Mi4yMzAwMSwwIC0xMTIuNjc3NCwtNTAuNDQ3MzkgLTExMi42Nzc0LC0xMTIuNjc3NHoiIGZpbGw9IiNmZjRkYTciIHN0cm9rZS13aWR0aD0iMCIvPjxnPjxwYXRoIGQ9Ik0zMTcuMTAyOSw4MC44MTA4N2MyMS44OTI0LDAgMzkuNjYyMDcsMTcuNzM3MjMgMzkuNjYyMDcsMzkuNjM0NGMwLDEyLjMwNTE3IC01LjYxMTQ4LDIzLjI5NjIyIC0xNC40MDA4OCwzMC41NjgyNGg4Ljc3MDMydjY4LjE3NTYzaC0xMTQuMTMzMjV2LTU1Ljc5ODg5Yy0xNC4zMzQwOCwtMy41MjgxNyAtMjQuOTYxNTMsLTE2LjQ1NzQ3IC0yNC45NjE1MywtMzEuODgwNDRjMCwtMTguMTM5IDE0LjY5NjczLC0zMi44MzQ3OCAzMi44MzQ3OCwtMzIuODM0NzhjMTIuMDM3OTUsMCAyMi41NTY2MSw2LjQ3ODAxIDI4LjI3MjExLDE2LjEzMzk1bDQuODYxMzcsLTAuOTI0NzVjMy4xMjkyNiwtMTguNzY2OTYgMTkuNDM5NzYsLTMzLjA3MzM2IDM5LjA5OTAyLC0zMy4wNzMzNnpNMjc2LjIxODUxLDE0MS4yOTE3MWMtMS4xMDAzNSwzLjUzMzg5IC0yLjc2OTQ3LDYuODEyMDMgLTQuOTIwNTQsOS43MjE3OWgyMC41NDc3NGMtMy42ODc1NCwtMy4wNDgxNCAtNi44MDI0OCwtNi43NjUyNyAtOS4xODU0NSwtMTAuOTQ0Mjl6IiBmaWxsPSIjZmZmZmZmIiBzdHJva2Utd2lkdGg9IjEiLz48cGF0aCBkPSJNMzM2LjU3NTI5LDExOS41MjgxNWMwLDExLjA2ODM1IC04Ljk3MjY0LDIwLjA0MDk5IC0yMC4wNDA5OSwyMC4wNDA5OWMtMTEuMDY4MzUsMCAtMjAuMDQwOTksLTguOTcyNjQgLTIwLjA0MDk5LC0yMC4wNDA5OWMwLC0xMS4wNjgzNSA4Ljk3MjY0LC0yMC4wNDA5OSAyMC4wNDA5OSwtMjAuMDQwOTljMTEuMDY4MzUsMCAyMC4wNDA5OSw4Ljk3MjY0IDIwLjA0MDk5LDIwLjA0MDk5eiIgZmlsbD0iI2ZmNGRhNyIgc3Ryb2tlLXdpZHRoPSIwLjUiLz48cGF0aCBkPSJNMjYxLjE4MywxMzAuMDI1ODFjMCw4Ljk2MDA0IC03LjI2MzYyLDE2LjIyMzY2IC0xNi4yMjM2NiwxNi4yMjM2NmMtOC45NjAwNCwwIC0xNi4yMjM2NiwtNy4yNjM2MiAtMTYuMjIzNjYsLTE2LjIyMzY2YzAsLTguOTYwMDQgNy4yNjM2MiwtMTYuMjIzNjYgMTYuMjIzNjYsLTE2LjIyMzY2YzguOTYwMDQsMCAxNi4yMjM2Niw3LjI2MzYyIDE2LjIyMzY2LDE2LjIyMzY2eiIgZmlsbD0iI2ZmNGRhNyIgc3Ryb2tlLXdpZHRoPSIwLjUiLz48cGF0aCBkPSJNMzg3Ljk2MDM5LDE0NS44NTcyNHY2MC41MTA0M2wtMjEuNjAzMjYsLTEzLjQ3MjE3aC0xNi44OTgzNHYtMzMuNTY2MDdoMTYuODk4MzRsMjEuNTk5MTcsLTEzLjQ3MTEyeiIgZmlsbD0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIxIi8+PC9nPjwvZz48L2c+PC9zdmc+PCEtLXJvdGF0aW9uQ2VudGVyOjExMi42NzcwNjU6MTEyLjY3NzQwNS0tPg==";
  const CW =
    "data:image/png;base64,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";
  const CCW =
    "data:image/png;base64,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";

  const vm = Scratch.vm;

  let cameraX = 0;
  let cameraY = 0;
  let cameraZoom = 100;
  let cameraDirection = 90;
  let cameraBG = "#ffffff";

  vm.runtime.runtimeOptions.fencing = false;
  vm.renderer.offscreenTouching = true;
  vm.setInterpolation(false);

  function updateCamera(
    x = cameraX,
    y = cameraY,
    scale = cameraZoom / 100,
    rot = -cameraDirection + 90
  ) {
    rot = (rot / 180) * Math.PI;
    const s = Math.sin(rot) * scale;
    const c = Math.cos(rot) * scale;
    const w = vm.runtime.stageWidth / 2;
    const h = vm.runtime.stageHeight / 2;
    vm.renderer._projection = [
      c / w,
      -s / h,
      0,
      0,
      s / w,
      c / h,
      0,
      0,
      0,
      0,
      -1,
      0,
      (c * -x + s * -y) / w,
      (c * -y - s * -x) / h,
      0,
      1,
    ];
    vm.renderer.dirty = true;
  }

  function updateCameraBG(color = cameraBG) {
    const rgb = Scratch.Cast.toRgbColorList(color);
    Scratch.vm.renderer.setBackgroundColor(
      rgb[0] / 255,
      rgb[1] / 255,
      rgb[2] / 255
    );
  }

  // tell resize to update camera as well
  vm.runtime.on("STAGE_SIZE_CHANGED", (_) => updateCamera());

  vm.runtime.on("RUNTIME_DISPOSED", (_) => {
    cameraX = 0;
    cameraY = 0;
    cameraZoom = 100;
    cameraDirection = 90;
    cameraBG = "#ffffff";
    updateCamera();
    updateCameraBG();
  });

  function _translateX(x, fromTopLeft = false, multiplier = 1, doZoom = true) {
    const w = fromTopLeft ? vm.runtime.stageWidth / 2 : 0;
    return (x - w) / (doZoom ? cameraZoom / 100 : 1) + w + cameraX * multiplier;
  }

  function _translateY(y, fromTopLeft = false, multiplier = 1, doZoom = true) {
    const h = fromTopLeft ? vm.runtime.stageHeight / 2 : 0;
    return (y - h) / (doZoom ? cameraZoom / 100 : 1) + h + cameraY * multiplier;
  }

  function rotate(cx, cy, x, y, radians) {
    const cos = Math.cos(radians),
      sin = Math.sin(radians),
      nx = cos * (x - cx) + sin * (y - cy) + cx,
      ny = cos * (y - cy) - sin * (x - cx) + cy;
    return [nx, ny];
  }

  // rotation hell
  function translateX(
    x,
    fromTopLeft = false,
    xMult = 1,
    doZoom = true,
    y = 0,
    yMult = xMult
  ) {
    if ((cameraDirection - 90) % 360 === 0 || !doZoom) {
      return _translateX(x, fromTopLeft, xMult, doZoom);
    } else {
      const w = fromTopLeft ? vm.runtime.stageWidth / 2 : 0;
      const h = fromTopLeft ? vm.runtime.stageHeight / 2 : 0;
      const rotated = rotate(
        cameraX + w,
        cameraY + h,
        _translateX(x, fromTopLeft, xMult, doZoom),
        _translateY(y, fromTopLeft, yMult, doZoom),
        ((-cameraDirection + 90) / 180) * Math.PI
      );
      return rotated[0];
    }
  }
  function translateY(
    y,
    fromTopLeft = false,
    yMult = 1,
    doZoom = true,
    x = 0,
    xMult = yMult
  ) {
    if ((cameraDirection - 90) % 360 === 0 || !doZoom) {
      return _translateY(y, fromTopLeft, yMult, doZoom);
    } else {
      const w = fromTopLeft ? vm.runtime.stageWidth / 2 : 0;
      const h = fromTopLeft ? vm.runtime.stageHeight / 2 : 0;
      const rotated = rotate(
        cameraX + w,
        cameraY + h,
        _translateX(x, fromTopLeft, xMult, doZoom),
        _translateY(y, fromTopLeft, yMult, doZoom),
        ((-cameraDirection + 90) / 180) * Math.PI
      );
      return rotated[1];
    }
  }

  // fix mouse positions
  const oldSX = vm.runtime.ioDevices.mouse.getScratchX;
  const oldSY = vm.runtime.ioDevices.mouse.getScratchY;
  vm.runtime.ioDevices.mouse.getScratchX = function (...a) {
    return translateX(
      oldSX.apply(this, a),
      false,
      1,
      true,
      oldSY.apply(this, a),
      1
    );
  };
  vm.runtime.ioDevices.mouse.getScratchY = function (...a) {
    return translateY(
      oldSY.apply(this, a),
      false,
      1,
      true,
      oldSX.apply(this, a),
      1
    );
  };
  const oldCX = vm.runtime.ioDevices.mouse.getClientX;
  const oldCY = vm.runtime.ioDevices.mouse.getClientY;
  vm.runtime.ioDevices.mouse.getClientX = function (...a) {
    return translateX(
      oldCX.apply(this, a),
      true,
      1,
      true,
      oldCY.apply(this, a),
      -1
    );
  };
  vm.runtime.ioDevices.mouse.getClientY = function (...a) {
    return translateY(
      oldCY.apply(this, a),
      true,
      -1,
      true,
      oldCX.apply(this, a),
      1
    );
  };

  const oldPick = vm.renderer.pick;
  vm.renderer.pick = function (x, y) {
    return oldPick.call(
      this,
      translateX(x, true, 1, true, y, -1),
      translateY(y, true, -1, true, x, 1)
    );
  };

  const oldExtract = vm.renderer.extractDrawableScreenSpace;
  vm.renderer.extractDrawableScreenSpace = function (...args) {
    const extracted = oldExtract.apply(this, args);
    extracted.x = translateX(extracted.x, false, -1, false, extracted.y, 1);
    extracted.y = translateY(extracted.y, false, 1, false, extracted.x, -1);
    return extracted;
  };

  // @ts-expect-error
  if (vm.runtime.ext_scratch3_looks) {
    // @ts-expect-error
    const oldPosBubble = vm.runtime.ext_scratch3_looks._positionBubble;
    // @ts-expect-error
    vm.runtime.ext_scratch3_looks._positionBubble = function (target) {
      // it's harder to limit speech bubbles to the camera region...
      // it's easier to just remove speech bubble bounds entirely
      const oldGetNativeSize = this.runtime.renderer.getNativeSize;
      this.runtime.renderer.getNativeSize = () => [Infinity, Infinity];
      try {
        return oldPosBubble.call(this, target);
      } finally {
        this.runtime.renderer.getNativeSize = oldGetNativeSize;
      }
    };
  }

  class Camera {
    getInfo() {
      return {
        id: "DTcameracontrols",
        name: Scratch.translate("Camera (Very Buggy)"),

        color1: "#ff4da7",
        color2: "#de4391",
        color3: "#c83c82",

        menuIconURI: icon,

        blocks: [
          {
            opcode: "moveSteps",
            blockType: Scratch.BlockType.COMMAND,
            text: Scratch.translate("move camera [val] steps"),
            arguments: {
              val: {
                type: Scratch.ArgumentType.NUMBER,
                defaultValue: 10,
              },
            },
          },
          {
            opcode: "rotateCW",
            blockType: Scratch.BlockType.COMMAND,
            text: Scratch.translate("turn camera [image] [val] degrees"),
            arguments: {
              image: {
                type: Scratch.ArgumentType.IMAGE,
                dataURI: CW,
              },
              val: {
                type: Scratch.ArgumentType.ANGLE,
                defaultValue: 15,
              },
            },
          },
          {
            opcode: "rotateCCW",
            blockType: Scratch.BlockType.COMMAND,
            text: Scratch.translate("turn camera [image] [val] degrees"),
            arguments: {
              image: {
                type: Scratch.ArgumentType.IMAGE,
                dataURI: CCW,
              },
              val: {
                type: Scratch.ArgumentType.ANGLE,
                defaultValue: 15,
              },
            },
          },
          "---",
          {
            opcode: "goTo",
            blockType: Scratch.BlockType.COMMAND,
            text: Scratch.translate("move camera to [sprite]"),
            arguments: {
              sprite: {
                type: Scratch.ArgumentType.STRING,
                menu: "sprites",
              },
            },
          },
          {
            opcode: "setBoth",
            blockType: Scratch.BlockType.COMMAND,
            text: Scratch.translate("set camera to x: [x] y: [y]"),
            arguments: {
              x: {
                type: Scratch.ArgumentType.NUMBER,
                defaultValue: 0,
              },
              y: {
                type: Scratch.ArgumentType.NUMBER,
                defaultValue: 0,
              },
            },
          },
          "---",
          {
            opcode: "setDirection",
            blockType: Scratch.BlockType.COMMAND,
            text: Scratch.translate("set camera direction to [val]"),
            arguments: {
              val: {
                type: Scratch.ArgumentType.ANGLE,
                defaultValue: 90,
              },
            },
          },
          {
            opcode: "pointTowards",
            blockType: Scratch.BlockType.COMMAND,
            text: Scratch.translate("point camera towards [sprite]"),
            arguments: {
              sprite: {
                type: Scratch.ArgumentType.STRING,
                menu: "sprites",
              },
            },
          },
          "---",
          {
            opcode: "changeX",
            blockType: Scratch.BlockType.COMMAND,
            text: Scratch.translate("change camera x by [val]"),
            arguments: {
              val: {
                type: Scratch.ArgumentType.NUMBER,
                defaultValue: 10,
              },
            },
          },
          {
            opcode: "setX",
            blockType: Scratch.BlockType.COMMAND,
            text: Scratch.translate("set camera x to [val]"),
            arguments: {
              val: {
                type: Scratch.ArgumentType.NUMBER,
                defaultValue: 0,
              },
            },
          },
          {
            opcode: "changeY",
            blockType: Scratch.BlockType.COMMAND,
            text: Scratch.translate("change camera y by [val]"),
            arguments: {
              val: {
                type: Scratch.ArgumentType.NUMBER,
                defaultValue: 10,
              },
            },
          },
          {
            opcode: "setY",
            blockType: Scratch.BlockType.COMMAND,
            text: Scratch.translate("set camera y to [val]"),
            arguments: {
              val: {
                type: Scratch.ArgumentType.NUMBER,
                defaultValue: 0,
              },
            },
          },
          "---",
          {
            opcode: "getX",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("camera x"),
          },
          {
            opcode: "getY",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("camera y"),
          },
          {
            opcode: "getDirection",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("camera direction"),
          },
          /*
          // debugging blocks
          {
            opcode: "getCX",
            blockType: Scratch.BlockType.REPORTER,
            text: "client x",
          },
          {
            opcode: "getCY",
            blockType: Scratch.BlockType.REPORTER,
            text: "client y",
          },
          */
          "---",
          {
            opcode: "blocktx",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("stage to world x: [x]"),
            arguments: {
              x: {
                type: Scratch.ArgumentType.NUMBER,
                defaultValue: 100,
              },
            },
          },
          {
            opcode: "blockty",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("stage to world y: [y]"),
            arguments: {
              y: {
                type: Scratch.ArgumentType.NUMBER,
                defaultValue: 100,
              },
            },
          },
          "---",
          {
            opcode: "changeZoom",
            blockType: Scratch.BlockType.COMMAND,
            text: Scratch.translate("change camera zoom by [val]"),
            arguments: {
              val: {
                type: Scratch.ArgumentType.NUMBER,
                defaultValue: 10,
              },
            },
          },
          {
            opcode: "setZoom",
            blockType: Scratch.BlockType.COMMAND,
            text: Scratch.translate("set camera zoom to [val] %"),
            arguments: {
              val: {
                type: Scratch.ArgumentType.NUMBER,
                defaultValue: 100,
              },
            },
          },
          {
            opcode: "getZoom",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("camera zoom"),
          },
          "---",
          {
            opcode: "setCol",
            blockType: Scratch.BlockType.COMMAND,
            text: Scratch.translate("set background color to [val]"),
            arguments: {
              val: {
                type: Scratch.ArgumentType.COLOR,
              },
            },
          },
          {
            opcode: "getCol",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("background color"),
          },
        ],
        menus: {
          sprites: {
            items: "getSprites",
            acceptReporters: true,
          },
        },
      };
    }

    getCX() {
      return vm.runtime.ioDevices.mouse.getClientX();
    }
    getCY() {
      return vm.runtime.ioDevices.mouse.getClientY();
    }

    getSprites() {
      const sprites = [];
      Scratch.vm.runtime.targets.forEach((e) => {
        if (e.isOriginal && !e.isStage) sprites.push(e.sprite.name);
      });
      if (sprites.length === 0) {
        sprites.push(Scratch.translate("no sprites exist"));
      }
      return sprites;
    }

    setBoth(args, util) {
      cameraX = +args.x;
      cameraY = +args.y;
      updateCamera();
      vm.runtime.requestRedraw();
    }
    changeZoom(args, util) {
      cameraZoom += +args.val;
      updateCamera();
      vm.runtime.requestRedraw();
    }
    setZoom(args, util) {
      cameraZoom = +args.val;
      updateCamera();
      vm.runtime.requestRedraw();
    }
    changeX(args, util) {
      cameraX += +args.val;
      updateCamera();
      vm.runtime.requestRedraw();
    }
    setX(args, util) {
      cameraX = +args.val;
      updateCamera();
      vm.runtime.requestRedraw();
    }
    changeY(args, util) {
      cameraY += +args.val;
      updateCamera();
      vm.runtime.requestRedraw();
    }
    setY(args, util) {
      cameraY = +args.val;
      updateCamera();
      vm.runtime.requestRedraw();
    }
    setDirection(args, util) {
      cameraDirection = +args.val;
      updateCamera();
      vm.runtime.requestRedraw();
    }
    rotateCW(args, util) {
      cameraDirection = cameraDirection + +args.val;
      updateCamera();
      vm.runtime.requestRedraw();
    }
    rotateCCW(args, util) {
      cameraDirection = cameraDirection - +args.val;
      updateCamera();
      vm.runtime.requestRedraw();
    }
    getX() {
      return cameraX;
    }
    getY() {
      return cameraY;
    }
    getZoom() {
      return cameraZoom;
    }
    getDirection() {
      return cameraDirection;
    }
    blocktx(args) {
      return _translateX(Scratch.Cast.toNumber(args.x));
    }
    blockty(args) {
      return _translateY(Scratch.Cast.toNumber(args.y));
    }
    setCol(args, util) {
      cameraBG = args.val;
      updateCameraBG();
    }
    getCol() {
      return cameraBG;
    }
    moveSteps(args) {
      const dir = ((-cameraDirection + 90) * Math.PI) / 180;
      cameraX += args.val * Math.cos(dir);
      cameraY += args.val * Math.sin(dir);
      updateCamera();
      vm.runtime.requestRedraw();
    }
    goTo(args, util) {
      const target = Scratch.Cast.toString(args.sprite);
      const sprite = vm.runtime.getSpriteTargetByName(target);
      if (!sprite) return;
      cameraX = Math.round(sprite.x);
      cameraY = Math.round(sprite.y);
      updateCamera();
      vm.runtime.requestRedraw();
    }
    pointTowards(args, util) {
      const target = Scratch.Cast.toString(args.sprite);
      const sprite = vm.runtime.getSpriteTargetByName(target);
      if (!sprite) return;
      const targetX = sprite.x;
      const targetY = sprite.y;
      const dx = targetX - cameraX;
      const dy = targetY - cameraY;
      cameraDirection = 90 - this.radToDeg(Math.atan2(dy, dx));
      updateCamera();
      vm.runtime.requestRedraw();
    }
    radToDeg(rad) {
      return (rad * 180) / Math.PI;
    }
  }

  Scratch.extensions.register(new Camera());
})(Scratch);
