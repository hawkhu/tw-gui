// Name: S-Grab
// ID: nexuskittensgrab
// Description: Get information about Scratch projects and Scratch users.
// By: NamelessCat <https://scratch.mit.edu/users/NamelessCat/>
// License: MIT

/* generated l10n code */Scratch.translate.setup({"fi":{"_S-Grab":"Scratch-koura","_[WHAT] of user [WHO]":"käyttäjän [WHO] [WHAT]","_about me":"tietoa minusta -teksti","_creator of project id [WHO]":"projektin [WHO] tekijä","_favorite":"suosikiksi valittujen","_follower":"seuraajien","_following":"seurattavien","_global [WHAT] ranking for [WHO]":"käyttäjän [WHO] [WHAT] maailmanlaajuinen sijoitus","_global [WHAT] ranking for project id [WHO]":"projektin [WHO] maailmanlaajuinen [WHAT] sijoitus","_grab [WHAT] count of project id [WHO]":"projektin [WHO] [WHAT] määrä","_grab [WHAT] count of user [WHO]":"käyttäjän [WHO] [WHAT] määrä","_location":"sijainti","_love":"rakastamisten","_name of project id [WHO]":"projektin [WHO] nimi","_status":"tila","_view":"katselukertojen","_wiwo":"minkä kanssa työskentelen -teksti"},"it":{"_[WHAT] of user [WHO]":"[WHAT] dell'utente [WHO]","_about me":"info su di me","_creator of project id [WHO]":"creatore del progetto con id [WHO]","_favorite":"favoriti","_global [WHAT] ranking for [WHO]":"poszione globale per [WHAT] di [WHO] ","_global [WHAT] ranking for project id [WHO]":"poszione globale per [WHAT] per il progetto con id [WHO] ","_grab [WHAT] count of project id [WHO]":"numero di [WHAT] del progetto con id [WHO]","_grab [WHAT] count of user [WHO]":"numero di [WHAT] dell'utente [WHO]","_location":"posizione","_name of project id [WHO]":"nome del progetto con id [WHO]","_status":"stato","_view":"visualizzazioni","_wiwo":"Su Cosa Sto Lavorando"},"ja":{"_S-Grab":"S-グラブ","_[WHAT] of user [WHO]":"ユーザー[WHO]の[WHAT]","_about me":"私について","_creator of project id [WHO]":"プロジェクトID[WHO]の作者","_favorite":"お気に入り","_follower":"フォロワー","_following":"フォロー","_global [WHAT] ranking for [WHO]":"世界中の[WHAT]ランキング中の[WHO]の位置","_global [WHAT] ranking for project id [WHO]":"世界中の[WHAT]ランキング中のプロジェクトID[WHO]の位置","_grab [WHAT] count of project id [WHO]":"プロジェクトID[WHO]の[WHAT]を取得する","_grab [WHAT] count of user [WHO]":"ユーザー[WHO]の[WHAT]を取得する","_location":"国","_love":"好き","_name of project id [WHO]":"プロジェクトID[WHO]の名前","_status":"ステータス","_view":"参照数","_wiwo":"私が取り組んでいること"},"ko":{"_S-Grab":"S-그랩","_[WHAT] of user [WHO]":"사용자 [WHO]의 [WHAT]","_about me":"내 소개","_creator of project id [WHO]":"프로젝트 ID [WHO]의 창작자","_favorite":"마음에 들어요","_follower":"팔로워","_following":"팔로잉","_global [WHAT] ranking for [WHO]":"[WHO]의 [WHAT] 세계 순위 값","_global [WHAT] ranking for project id [WHO]":"프로젝트 ID [WHO]의 [WHAT]의 세계 순위 값","_grab [WHAT] count of project id [WHO]":"프로젝트 ID [WHO]의 [WHAT] 값","_grab [WHAT] count of user [WHO]":"사용자 [WHO]의 [WHAT] 값","_location":"국가","_love":"좋아요","_name of project id [WHO]":"프로젝트 ID [WHO]의 이름","_status":"상태","_view":"조회수","_wiwo":"내가 하고 있는 일"},"nb":{"_S-Grab":"S-Gripe","_[WHAT] of user [WHO]":"[WHAT] av bruker [WHO]","_about me":"om meg","_creator of project id [WHO]":"skaper av prosjekt id [WHO]","_favorite":"favoritt","_follower":"følger","_following":"følgende","_global [WHAT] ranking for [WHO]":"global [WHAT] rangering for [WHO]","_global [WHAT] ranking for project id [WHO]":"global [WHAT] rangering for prosjekt-id [WHO]","_grab [WHAT] count of project id [WHO]":"hent [WHAT] antall prosjekt-id [WHO]","_grab [WHAT] count of user [WHO]":"hent [WHAT] antall bruker [WHO]","_location":"sted","_love":"liker","_name of project id [WHO]":"navn på prosjekt-id [WHO]","_view":"visning"},"nl":{"_[WHAT] of user [WHO]":"[WHAT] van gebruiker [WHO]","_about me":"over mij","_creator of project id [WHO]":"maker van project-id [WHO]","_favorite":"sterretjes","_follower":"volgers","_following":"volgend","_global [WHAT] ranking for [WHO]":"positie van [WHO] in globale ranglijst voor [WHAT]","_global [WHAT] ranking for project id [WHO]":"positie van project-id [WHO] in globale ranglijst voor [WHAT]","_grab [WHAT] count of project id [WHO]":"aantal [WHAT] van project-id [WHO]","_grab [WHAT] count of user [WHO]":"aantal [WHAT] van gebruiker [WHO]","_location":"locatie","_love":"hartjes","_name of project id [WHO]":"naam van project-id [WHO]","_view":"weergaven","_wiwo":"waar ik mee bezig ben"},"ru":{"_S-Grab":"S-Хватал","_[WHAT] of user [WHO]":"[WHAT] пользователя [WHO]","_about me":"обо мне","_creator of project id [WHO]":"создатель проекта с id [WHO]","_favorite":"звёздочек","_follower":"подписчиков","_following":"подписанных","_global [WHAT] ranking for [WHO]":"глобальная позиция ранга [WHAT] пользователя [WHO]","_global [WHAT] ranking for project id [WHO]":"глобальная позиция [WHAT] проекта с id [WHO]","_grab [WHAT] count of project id [WHO]":"взять количество [WHAT] проекта с id [WHO]","_grab [WHAT] count of user [WHO]":"взять количество [WHAT] пользователя [WHO]","_location":"локацию","_love":"сердечек","_name of project id [WHO]":"имя проекта с id [WHO]","_status":"статус","_view":"просмотров","_wiwo":"над чем я работаю"},"tr":{"_S-Grab":"S-Grab\n "},"zh-cn":{"_[WHAT] of user [WHO]":"获取Scratch用户[WHO]的[WHAT]","_about me":"简介","_creator of project id [WHO]":"获取Scratch作品ID为[WHO]的制作者","_favorite":"收藏","_follower":"粉丝","_following":"关注者","_global [WHAT] ranking for [WHO]":"获取Scratch用户[WHO]在[WHAT]的排名","_global [WHAT] ranking for project id [WHO]":"获取Scratch作品ID为[WHO]在[WHAT]的屏幕","_grab [WHAT] count of project id [WHO]":"获取Scratch作品ID为[WHO]的[WHAT]数量","_grab [WHAT] count of user [WHO]":"获取Scratch用户[WHO]的[WHAT]数量","_location":"居住地","_love":"点赞","_name of project id [WHO]":"获取Scratch作品ID为[WHO]的名称","_status":"用户类型","_view":"观看数","_wiwo":"工作"}});/* end generated l10n code */(function (Scratch) {
  "use strict";

  if (!Scratch.extensions.unsandboxed) {
    throw new Error("This Extension must run unsandboxed");
  }

  class nexuskittensgrab {
    getInfo() {
      return {
        id: "nexuskittensgrab",
        name: Scratch.translate("S-Grab"),
        color1: "#ECA90B",
        color2: "#EBAF00",
        blocks: [
          {
            opcode: "usergrab2",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("[WHAT] of user [WHO]"),
            arguments: {
              WHAT: {
                type: Scratch.ArgumentType.STRING,
                menu: "WHAT5",
              },
              WHO: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "griffpatch",
              },
            },
          },
          {
            opcode: "projectgrab",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("grab [WHAT] count of project id [WHO]"),
            arguments: {
              WHAT: {
                type: Scratch.ArgumentType.STRING,
                menu: "WHAT3",
              },
              WHO: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "60917032",
              },
            },
          },
          {
            opcode: "idtoname",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("name of project id [WHO]"),
            arguments: {
              WHO: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "60917032",
              },
            },
          },
          {
            opcode: "idtoowner",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("creator of project id [WHO]"),
            arguments: {
              WHO: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "60917032",
              },
            },
          },

          "---",
          {
            blockType: Scratch.BlockType.XML,
            xml: "<sep gap='12'/><label text='The blocks below rely on a third-party'/><sep gap='-12'/><label text='API that is currently offline.'/>",
          },
          {
            opcode: "usergrab",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("grab [WHAT] count of user [WHO]"),
            arguments: {
              WHAT: {
                type: Scratch.ArgumentType.STRING,
                menu: "WHAT",
              },
              WHO: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "griffpatch",
              },
            },
          },
          {
            opcode: "rankusergrab",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("global [WHAT] ranking for [WHO]"),
            arguments: {
              WHAT: {
                type: Scratch.ArgumentType.STRING,
                menu: "WHAT2",
              },
              WHO: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "griffpatch",
              },
            },
          },
          {
            opcode: "rankprojectgrab",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate(
              "global [WHAT] ranking for project id [WHO]"
            ),
            arguments: {
              WHAT: {
                type: Scratch.ArgumentType.STRING,
                menu: "WHAT4",
              },
              WHO: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "60917032",
              },
            },
          },
        ],
        menus: {
          WHAT: {
            acceptReporters: true,
            items: [
              {
                text: Scratch.translate("follower"),
                value: "follower",
              },
              {
                text: Scratch.translate("following"),
                value: "following",
              },
            ],
          },
          WHAT2: {
            acceptReporters: true,
            items: [
              {
                text: Scratch.translate("follower"),
                value: "follower",
              },
              {
                text: Scratch.translate("love"),
                value: "love",
              },
              {
                text: Scratch.translate("favorite"),
                value: "favorite",
              },
              {
                text: Scratch.translate("view"),
                value: "view",
              },
            ],
          },
          WHAT3: {
            acceptReporters: true,
            items: [
              {
                text: Scratch.translate("love"),
                value: "love",
              },
              {
                text: Scratch.translate("favorite"),
                value: "favorite",
              },
              {
                text: Scratch.translate("view"),
                value: "view",
              },
            ],
          },
          WHAT4: {
            acceptReporters: true,
            items: [
              {
                text: Scratch.translate("love"),
                value: "love",
              },
              {
                text: Scratch.translate("favorite"),
                value: "favorite",
              },
              {
                text: Scratch.translate("view"),
                value: "view",
              },
            ],
          },
          WHAT5: {
            acceptReporters: true,
            items: [
              {
                text: Scratch.translate("about me"),
                value: "about me",
              },
              {
                text: Scratch.translate({
                  default: "wiwo",
                  description:
                    "WIWO stands for 'What I'm Working On', part of the Scratch profile page.",
                }),
                value: "wiwo",
              },
              {
                text: Scratch.translate("location"),
                value: "location",
              },
              {
                text: Scratch.translate("status"),
                value: "status",
              },
            ],
          },
        },
      };
    }
    async usergrab(args) {
      try {
        const response = await Scratch.fetch(
          "https://scratchdb.lefty.one/v3/user/info/" + args.WHO
        );
        if (!response.ok) {
          return "";
        }
        const jsonData = await response.json();
        if (args.WHAT === "follower") {
          return jsonData.statistics.followers ?? "";
        } else if (args.WHAT === "following") {
          return jsonData.statistics.following ?? "";
        } else {
          return "";
        }
      } catch (error) {
        return "";
      }
    }
    async rankusergrab(args) {
      try {
        const response = await Scratch.fetch(
          "https://scratchdb.lefty.one/v3/user/info/" + args.WHO
        );
        if (!response.ok) {
          return "";
        }
        const jsonData = await response.json();
        if (args.WHAT === "follower") {
          return jsonData.statistics.ranks.followers ?? "";
        } else if (args.WHAT === "love") {
          return jsonData.statistics.ranks.loves ?? "";
        } else if (args.WHAT === "favorite") {
          return jsonData.statistics.ranks.favorites ?? "";
        } else if (args.WHAT === "view") {
          return jsonData.statistics.ranks.views ?? "";
        } else {
          return "";
        }
      } catch (error) {
        return "";
      }
    }
    async usergrab2(args) {
      try {
        const response = await Scratch.fetch(
          `https://trampoline.turbowarp.org/api/users/${args.WHO}`
        );
        if (!response.ok) {
          return "";
        }
        const jsonData = await response.json();
        if (args.WHAT === "about me") {
          return jsonData.profile.bio ?? "";
        } else if (args.WHAT === "wiwo") {
          return jsonData.profile.status ?? "";
        } else if (args.WHAT === "location") {
          return jsonData.profile.country ?? "";
        } else if (args.WHAT === "status") {
          // ScratchDB would tell us whether they are a New Scratcher but api.scratch.mit.edu doesn't
          return jsonData.scratchteam ? "Scratch Team" : "Scratcher";
        } else {
          return "";
        }
      } catch (error) {
        return "";
      }
    }
    async projectgrab(args) {
      try {
        const response = await Scratch.fetch(
          `https://trampoline.turbowarp.org/api/projects/${args.WHO}`
        );
        if (!response.ok) {
          return "";
        }
        const jsonData = await response.json();
        if (args.WHAT === "love") {
          return jsonData.stats.loves ?? "";
        } else if (args.WHAT === "favorite") {
          return jsonData.stats.favorites ?? "";
        } else if (args.WHAT === "view") {
          return jsonData.stats.views ?? "";
        } else {
          return "";
        }
      } catch (error) {
        return "";
      }
    }
    async rankprojectgrab(args) {
      try {
        const response = await Scratch.fetch(
          "https://scratchdb.lefty.one/v3/project/info/" + args.WHO
        );
        if (!response.ok) {
          return "";
        }
        const jsonData = await response.json();
        if (args.WHAT === "love") {
          return jsonData.statistics.ranks.loves ?? "";
        } else if (args.WHAT === "favorite") {
          return jsonData.statistics.ranks.favorites ?? "";
        } else if (args.WHAT === "view") {
          return jsonData.statistics.ranks.views ?? "";
        } else {
          return "";
        }
      } catch (error) {
        return "";
      }
    }
    async idtoname(args) {
      try {
        const response = await Scratch.fetch(
          `https://trampoline.turbowarp.org/api/projects/${args.WHO}`
        );
        if (!response.ok) {
          return "";
        }
        const jsonData = await response.json();
        return jsonData.title ?? "";
      } catch (error) {
        return "";
      }
    }
    async idtoowner(args) {
      try {
        const response = await Scratch.fetch(
          `https://trampoline.turbowarp.org/api/projects/${args.WHO}`
        );
        if (!response.ok) {
          return "";
        }
        const jsonData = await response.json();
        return jsonData.author.username ?? "";
      } catch (error) {
        return "";
      }
    }
  }
  Scratch.extensions.register(new nexuskittensgrab());
})(Scratch);
