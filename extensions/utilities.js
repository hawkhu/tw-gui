// Name: Utilities
// ID: utilities
// Description: A bunch of interesting blocks.
// Original: Sheep_maker <https://scratch.mit.edu/users/Sheep_maker/>
// License: MIT AND MPL-2.0

/*!
 * This is based on:
 * https://github.com/SheepTester/sheeptester.github.io/blob/master/javascripts/utilities.js
 *
 * Original license:
 * MIT License
 *
 * Copyright (c) 2021 Sean
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */

/* generated l10n code */Scratch.translate.setup({"de":{"_Utilities":"Verschiedene Blöcke"},"fi":{"_Utilities":"Työkalut","_[PATH] of [JSON_STRING]":"[PATH] JSON-koodissa [JSON_STRING]","_clamp [INPUT] between [MIN] and [MAX]":"rajoita [INPUT] välille [MIN] – [MAX]","_content from [URL]":"sisältö URL-osoitteesta [URL]","_current millisecond":"nykyinen millisekunti","_false":"epätosi","_if [A] then [B] else [C]":"jos [A], niin [B] tai muuten [C]","_is [A] exactly [B]?":"onko [A] tarkalleen [B]?","_letters [START] to [END] of [STRING]":"merkkijonon [STRING] merkit [START] – [END]","_newline character":"uusi rivi","_pi":"pii","_replace [STRING] using the rule [REGEX] with [NEWSTRING]":"korvaa [REGEX] merkkijonolla [NEWSTRING] merkkijonossa [STRING]","_true":"tosi"},"it":{"_Utilities":"Utilità","_newline character":"carattere accapo","_pi":"pi greco"},"ja":{"_Utilities":"ユーティリティ","_[PATH] of [JSON_STRING]":"[JSON_STRING]の[PATH]","_clamp [INPUT] between [MIN] and [MAX]":"[INPUT]を[MIN]から[MAX]までで表す","_content from [URL]":"[URL]からのコンテンツ","_current millisecond":"現在のミリ秒","_false":"偽","_if [A] then [B] else [C]":"もし[A]なら[B]でなければ[C]","_is [A] exactly [B]?":"[A]が[B]と同一","_letters [START] to [END] of [STRING]":"[STRING]の[START]から[END]番目","_newline character":"改行文字","_pi":"π","_replace [STRING] using the rule [REGEX] with [NEWSTRING]":"[STRING]の[REGEX]を[NEWSTRING]に置き換える","_true":"真"},"ko":{"_Utilities":"유틸리티","_[PATH] of [JSON_STRING]":"[JSON_STRING]에서 [PATH]","_clamp [INPUT] between [MIN] and [MAX]":"[INPUT] 값을 [MIN]부터 [MAX]까지 범위로 제한","_content from [URL]":"[URL]의 내용","_current millisecond":"현재 밀리초","_false":"거짓","_if [A] then [B] else [C]":"[A] (이)라면 [B] 아니면 [C]","_is [A] exactly [B]?":"[A]이(가) [B]와(과) 일치하는가?","_letters [START] to [END] of [STRING]":"[STRING]의 [START]부터 [END]까지의 글자","_newline character":"줄바꿈 문자","_true":"참"},"nb":{"_Utilities":"Verktøy","_true":"sann"},"nl":{"_Utilities":"Utiliteiten","_[PATH] of [JSON_STRING]":"[PATH] van [JSON_STRING]","_clamp [INPUT] between [MIN] and [MAX]":"klem [INPUT] tussen [MIN] en [MAX]","_current millisecond":"huidige milliseconde","_false":"onwaar","_if [A] then [B] else [C]":"als [A] dan [B] anders [C]","_is [A] exactly [B]?":"is [A] precies [B]?","_letters [START] to [END] of [STRING]":"letters [START] t/m [END] van [STRING]","_newline character":"nieuwregelteken","_replace [STRING] using the rule [REGEX] with [NEWSTRING]":"vervang [STRING] met regel [REGEX] door [NEWSTRING]","_true":"waar"},"pl":{"_false":"fałsz"},"ru":{"_Utilities":"Утилиты","_[PATH] of [JSON_STRING]":"[PATH] из [JSON_STRING]","_clamp [INPUT] between [MIN] and [MAX]":"зажим [INPUT] между [MIN] и [MAX]","_content from [URL]":"контент из [URL]","_current millisecond":"текущие миллисекунды","_false":"нет","_if [A] then [B] else [C]":"если [A] тогда [B] иначе [C]","_is [A] exactly [B]?":"[A] точно ли [B]?","_letters [START] to [END] of [STRING]":"буквы с [START] до [END] в строке [STRING]","_newline character":"символ новой строки","_pi":"пи","_replace [STRING] using the rule [REGEX] with [NEWSTRING]":"заменить [STRING] используя правило [REGEX] с [NEWSTRING]","_true":"да"},"uk":{"_newline character":"символ переносу строки"},"zh-cn":{"_Utilities":"工具","_[PATH] of [JSON_STRING]":"[JSON_STRING]中的[PATH]","_clamp [INPUT] between [MIN] and [MAX]":"[MIN]到[MAX]之间的[INPUT]","_content from [URL]":"来自[URL]的内容","_current millisecond":"当前毫秒","_false":"假","_if [A] then [B] else [C]":"[A]？[B]：[C]","_is [A] exactly [B]?":"[A]===[B]","_letters [START] to [END] of [STRING]":"[STRING]的第[START]到第[END]位","_newline character":"换行符","_pi":"π","_replace [STRING] using the rule [REGEX] with [NEWSTRING]":"以规则[REGEX]替换[STRING]为[NEWSTRING]","_true":"真"}});/* end generated l10n code */(function (Scratch) {
  "use strict";

  const icon =
    "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAADTUlEQVRIS63VTWgUZxgH8P+7Mzsf+2U2SrPJKBoEA1WKUMzupaKHpgoetadCnaBN9FRaLLRQEW17KKIed1V21dJLbU/FRqiixx219NDaVi+NmnWNZT+cze7Ozsf7yoxEYpnMRJI5DQzP+5v3P8/7DEHANVHM7iXAVyAkwQCNgZYjDp3KH7jzZ1DdwmckBLirrE29KQgcTNOBZTrQdYP2es631LSPnp34zQqDlgTIcvTlOowxNBsG6o3uHw6he899eOt+EBIGeBHxUW5ElDjEYwKSKdFbzzAsVB61/q4lWlsvv3/XXAwJBOaL9pe29slE3MgoOSHF+N0DAwnwfASNehe1WudkYVw7sixgYfFkMXtSikU/VZQU3LhmHjVZ17Sz59Tbt/2QJe3glUIGMnEhe3PgjcR2Ny5dN/Df0873ebX8gS/wshUBUMK+PKveuhzWGZPF0fdiceHq4FAK3a6FyoyuFca13GKA14ruw8qM/ldhXNscBnz03duDUSY83jCchu04ePBvs5ZXtTW+wGQpW12/IZ1xP9r0dAM9g2bOH9Rmg5DDpW0ZwvFVD7CpW1ctqNqQP1DM/ZJRErvdFqw+bqHdMccKqvZr4AEsbdsVj4lTbkTttolqtXWloGp7FtlB7uv+1fIX6bSM9pyJJ9W5a3m1PAYC5ou4H7mUvT44mNwZTwio17to1Dsn8qp21Bc4cGl0WCLcP+vW9wkRQrxddNrW6cyw9NmxnTfthUX7ftgs9LcTP8dkfmxIWeW16cOHTdO22EheLU8v2qYTxezn6bT8zeo1MS/T2dk5GB3rHgNOMd6+SsFxnE3eJcAnohwdUZQkQAjqtTYadePHwri2L/CgHbuxg3/ywPhdUZJbJOnF3GnpPS9fw7ABAkgij3h8flS46REYPRvVig5KoebV8oXAg3bw4ugmjkV+6u+Xt/T1SSDE/wy6sTxrdiHHBYgCH4q8ssqLjOPHZYk/kkiKEUHg4Y5qBgbLpDBNG62W5Rhde4rjsGdISUEUgxHf1zx0MfsWdTBGCHIAeQeABbAyBdPmfziTpdz+SASlMOT1Z9GCoJeCLAtwrTBk2UAYsiKAH+JN2YreXDHg/wilzJ3Oz1YUmEcYY2fce0LIx88BFi6vvp70RPYAAAAASUVORK5CYII=";

  class Utilities {
    getInfo() {
      return {
        id: "utilities",
        name: Scratch.translate("Utilities"),

        color1: "#8BC34A",
        color2: "#7CB342",
        color3: "#689F38",

        menuIconURI: icon,

        blocks: [
          {
            opcode: "isExactly",

            blockType: Scratch.BlockType.BOOLEAN,

            text: Scratch.translate("is [A] exactly [B]?"),
            arguments: {
              A: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "apple",
              },
              B: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "APPLE",
              },
            },
          },
          {
            opcode: "isLessOrEqual",

            blockType: Scratch.BlockType.BOOLEAN,

            // eslint-disable-next-line extension/should-translate
            text: "[A] <= [B]",
            arguments: {
              A: {
                type: Scratch.ArgumentType.NUMBER,
              },
              B: {
                type: Scratch.ArgumentType.NUMBER,
                defaultValue: 50,
              },
            },
          },
          {
            opcode: "isMoreOrEqual",

            blockType: Scratch.BlockType.BOOLEAN,

            // eslint-disable-next-line extension/should-translate
            text: "[A] >= [B]",
            arguments: {
              A: {
                type: Scratch.ArgumentType.NUMBER,
              },
              B: {
                type: Scratch.ArgumentType.NUMBER,
                defaultValue: 50,
              },
            },
          },
          {
            opcode: "trueBlock",
            blockType: Scratch.BlockType.BOOLEAN,
            text: Scratch.translate({
              default: "true",
              description: "Block that returns true",
            }),
            disableMonitor: true,
          },
          {
            opcode: "falseBlock",
            blockType: Scratch.BlockType.BOOLEAN,
            text: Scratch.translate({
              default: "false",
              description: "Block that returns false",
            }),
            disableMonitor: true,
          },
          {
            opcode: "exponent",

            blockType: Scratch.BlockType.REPORTER,

            // eslint-disable-next-line extension/should-translate
            text: "[A] ^ [B]",
            arguments: {
              A: {
                type: Scratch.ArgumentType.NUMBER,
              },
              B: {
                type: Scratch.ArgumentType.NUMBER,
              },
            },
          },
          {
            opcode: "pi",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate({
              default: "pi",
              description: "Block that returns 3.1415...",
            }),
          },
          {
            opcode: "ternaryOperator",

            blockType: Scratch.BlockType.REPORTER,

            text: Scratch.translate("if [A] then [B] else [C]"),
            arguments: {
              A: {
                type: Scratch.ArgumentType.BOOLEAN,
              },
              B: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "banana",
              },
              C: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "apple",
              },
            },
            allowDropAnywhere: true,
          },
          {
            opcode: "letters",

            blockType: Scratch.BlockType.REPORTER,

            text: Scratch.translate("letters [START] to [END] of [STRING]"),
            arguments: {
              START: {
                type: Scratch.ArgumentType.NUMBER,
                defaultValue: 5,
              },
              END: {
                type: Scratch.ArgumentType.NUMBER,
                defaultValue: 7,
              },
              STRING: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "red apple",
              },
            },
          },
          {
            opcode: "clamp",

            blockType: Scratch.BlockType.REPORTER,

            text: Scratch.translate("clamp [INPUT] between [MIN] and [MAX]"),
            arguments: {
              INPUT: {
                type: Scratch.ArgumentType.NUMBER,
                defaultValue: 30,
              },
              MIN: {
                type: Scratch.ArgumentType.NUMBER,
                defaultValue: 25,
              },
              MAX: {
                type: Scratch.ArgumentType.NUMBER,
                defaultValue: 40,
              },
            },
          },
          {
            opcode: "currentMillisecond",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("current millisecond"),
          },
          {
            opcode: "fetchFrom",

            blockType: Scratch.BlockType.REPORTER,

            text: Scratch.translate("content from [URL]"),
            arguments: {
              URL: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "https://extensions.turbowarp.org/hello.txt",
              },
            },
          },
          {
            opcode: "parseJSON",

            blockType: Scratch.BlockType.REPORTER,

            text: Scratch.translate({
              default: "[PATH] of [JSON_STRING]",
              description:
                'PATH is a string like "fruit/apples" and JSON_STRING is an object like {"fruit":{"apples":3}}. 3 would be reported in this example.',
            }),
            arguments: {
              PATH: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "fruit/apples",
              },
              JSON_STRING: {
                type: Scratch.ArgumentType.STRING,
                defaultValue:
                  '{"fruit": {"apples": 2, "bananas": 3}, "total_fruit": 5}',
              },
            },
          },
          {
            opcode: "newline",
            blockType: Scratch.BlockType.REPORTER,
            text: Scratch.translate("newline character"),
            disableMonitor: true,
            arguments: {},
          },
          {
            opcode: "stringToBoolean",

            blockType: Scratch.BlockType.BOOLEAN,

            // eslint-disable-next-line extension/should-translate
            text: "[STRING]",
            arguments: {
              STRING: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "true",
              },
            },
          },
          {
            opcode: "regexReplace",

            blockType: Scratch.BlockType.REPORTER,

            text: Scratch.translate(
              "replace [STRING] using the rule [REGEX] with [NEWSTRING]"
            ),
            arguments: {
              STRING: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "bananas are awesome. i like bananas.",
              },
              REGEX: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "banana",
              },
              NEWSTRING: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "apple",
              },
            },
          },
        ],
      };
    }

    isExactly({ A, B }) {
      return A === B;
    }

    isLessOrEqual({ A, B }) {
      return Scratch.Cast.compare(A, B) <= 0;
    }

    isMoreOrEqual({ A, B }) {
      return Scratch.Cast.compare(A, B) >= 0;
    }

    trueBlock() {
      return true;
    }

    falseBlock() {
      return false;
    }

    exponent({ A, B }) {
      A = Scratch.Cast.toNumber(A);
      B = Scratch.Cast.toNumber(B);
      return Math.pow(A, B);
    }

    pi() {
      return Math.PI;
    }

    ternaryOperator({ A, B, C }) {
      return A ? B : C;
    }

    letters({ STRING, START, END }) {
      return STRING.slice(Math.max(1, START) - 1, Math.min(STRING.length, END));
    }

    clamp({ INPUT, MIN, MAX }) {
      INPUT = Scratch.Cast.toNumber(INPUT);
      MIN = Scratch.Cast.toNumber(MIN);
      MAX = Scratch.Cast.toNumber(MAX);
      if (MIN > MAX) {
        return Math.min(Math.max(INPUT, MAX), MIN);
      } else {
        return Math.min(Math.max(INPUT, MIN), MAX);
      }
    }

    currentMillisecond() {
      return Date.now() % 1000;
    }

    fetchFrom({ URL }) {
      return Scratch.fetch(URL)
        .then((res) => res.text())
        .catch((err) => "");
    }

    parseJSON({ PATH, JSON_STRING }) {
      try {
        const path = PATH.toString()
          .split("/")
          .map((prop) => decodeURIComponent(prop));
        if (path[0] === "") path.splice(0, 1);
        if (path[path.length - 1] === "") path.splice(-1, 1);
        let json;
        try {
          json = JSON.parse(" " + JSON_STRING);
        } catch (e) {
          return e.message;
        }
        path.forEach((prop) => (json = json[prop]));
        if (json === null) return "null";
        else if (json === undefined) return "";
        else if (typeof json === "object") return JSON.stringify(json);
        else return json.toString();
      } catch (err) {
        return "";
      }
    }

    newline() {
      return "\n";
    }

    stringToBoolean({ STRING }) {
      return STRING;
    }

    regexReplace({ STRING, REGEX, NEWSTRING }) {
      return STRING.toString().replace(new RegExp(REGEX, "gi"), NEWSTRING);
    }
  }

  Scratch.extensions.register(new Utilities());
})(Scratch);
